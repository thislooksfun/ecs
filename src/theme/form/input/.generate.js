// This is a script that should not be included from any scripts.

import fs from "fs";
import path from "path";

const moduleUrl = new URL(import.meta.url);
const dirname = path.dirname(moduleUrl.pathname);

// Delete all files not starting with a '.'
const files = fs.readdirSync(dirname);
for (const file of files) {
  if (file.startsWith(".")) continue;
  fs.unlinkSync(path.join(dirname, file));
}

const templatePath = path.join(dirname, ".template");
const template = fs.readFileSync(templatePath, { encoding: "utf-8" });

const header = "<!-- THIS FILE WAS AUTOGENERATED, DO NOT EDIT -->\n";

// Create the inputs!
const types = {
  email: "string",
  text: "string",
  password: "string",
};

for (const [type, valtype] of Object.entries(types)) {
  const typed = template
    .replaceAll("[[type]]", type)
    .replaceAll("[[valtype]]", valtype);
  const filePath = path.join(dirname, `${type}.svelte`);
  fs.writeFileSync(filePath, header + typed);
}
